<?xml version="1.0" encoding="utf-8"?>
<Grammar name="mission" type="graph" findFirst="true">
  <Constraints>
    <!-- Constraint 1: At least 2 sidepaths (if >= 5 elements exist) -->
    <Constraint name="constraint1_10enemies" active="true">
      <GrammarCondition>CountElements("Has(#enemy)","&lt;=",10)</GrammarCondition>
      <Rules>
        <Rule probability="1">
          <Query>constraint1_query</Query>
          <Target>constraint1_target</Target>
        </Rule>
      </Rules>
    </Constraint>
	<Constraint name="constraint2_branch" active="true">
      <GrammarCondition>SumAttribute(,"const_branch","&lt;=",5)</GrammarCondition>
      <Rules>
        <Rule probability="1">
          <Query>constraint2_query</Query>
          <Target>constraint2_target</Target>
        </Rule>
      </Rules>
    </Constraint>
	<Constraint name="constraint3_shortpath" active="true">
      <GrammarCondition>CountElementsProximity("Has(#const_shortpath)","&lt;=",3)</GrammarCondition>
      <Rules>
        <Rule probability="1">
          <Query>constraint3_query</Query>
          <Target>constraint3_target</Target>
        </Rule>
      </Rules>
    </Constraint>
  </Constraints>
  <Rules>
    <Initial probability="0.5">
      <Target>initial_1</Target>
    </Initial>
    <Initial probability="0.5">
      <Target>initial_2</Target>
    </Initial>
	<Rule probability="0.1">
      <Query>enemy_chain_query</Query>
      <Target>enemy_chain_target</Target>
    </Rule>
	<Rule probability="0.1">
      <Query>insert_branch_query</Query>
      <Target>insert_branch_target</Target>
    </Rule>
	<Rule probability="0.1">
      <Query>generate_keylock_query</Query>
      <Target>generate_keylock_target</Target>
    </Rule>
    <Rule probability="0.3">
      <Query>add_enemy_query</Query>
      <Target>add_enemy_target</Target>
    </Rule>
    <Rule probability="0.05" name="linkback">
      <!-- TODO: Add condition for this, etc -->
      <Query>linkback_query</Query>
      <Target>linkback_target</Target>
    </Rule>
    <Rule probability="0.05">
      <Query>endlevel_query</Query>
      <Target>endlevel_target</Target>
    </Rule>
    <Rule probability="0.25">
      <Query>improve_pacing_query</Query>
      <Target>improve_pacing_target</Target>
    </Rule>
    <Rule probability="0.05">
      <Query>endbranch_query</Query>
      <Target>endbranch_target</Target>
    </Rule>
  </Rules>
  <StopConditions>
    <GrammarCondition name="SumAttribute">
      <string>where [d(#sidepath) &gt; 0.199]</string>
      <string>sidepath</string>
      <string>&gt;=</string>
      <double>1.6</double>
    </GrammarCondition>
    <GrammarCondition name="CountElements">
      <string>from [edges] where [#_demo_color = "red"]</string>
      <string>&gt;=</string>
      <double>8</double>
    </GrammarCondition>
  </StopConditions>
</Grammar>